@page "/chats"
@using chattr.Shared.Models
@using Blazored.SessionStorage

@inject IJSRuntime _jsRuntime
@inject ISessionStorageService _sessionStorage

<div class="container-fluid">
    <ChatsMenu OnMessageLoad="MessagesLoaded" OnMessageUnload="MessagedUnloaded"/>
    
    <div>
        @if (_messages is not null && _currentUser is not null)
        {
            @foreach (var msg in _messages)
            {
                <div class="@(_currentUser.Id == msg.UserId ? "rounded bg-info" : "rounded bg-secondary") 
                    text-light msg">
                    @msg.Content

                    <small class="form-text disabled">przesłano: @msg.SendDate</small>
                </div>
            }
        }
    </div>
</div>

@code {

    private List<Message> _messages;

    private User _currentUser;

    private async Task MessagesLoaded(List<Message> messages)
    {
        _messages = messages;
        await _jsRuntime.InvokeVoidAsync("console.log", messages);

        _currentUser = await _sessionStorage.GetItemAsync<User>("CURRENT_USER");
        StateHasChanged();
    }

    private async Task MessagedUnloaded()
    {
        _messages = null;
        StateHasChanged();
    }

}